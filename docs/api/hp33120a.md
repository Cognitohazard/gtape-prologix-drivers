# HP33120A

Arbitrary Waveform Generator - 15MHz, 12-bit DAC (-2047 to +2047), 8-16000 points, 40 MSa/s.

## Import

```python
from gtape_prologix_drivers import HP33120A
```

## Constructor

```python
HP33120A(adapter)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `adapter` | PrologixAdapter | Connected adapter instance |

## Class Constants

### DAC Range
| Constant | Value | Description |
|----------|-------|-------------|
| `DAC_MIN` | -2047 | Minimum DAC value (signed) |
| `DAC_MAX` | 2047 | Maximum DAC value (signed) |
| `MIN_POINTS` | 8 | Minimum waveform points |
| `MAX_POINTS` | 16000 | Maximum waveform points |

### Function Shapes
| Constant | Value | Description |
|----------|-------|-------------|
| `SHAPE_SINE` | "SIN" | Sine wave |
| `SHAPE_SQUARE` | "SQU" | Square wave |
| `SHAPE_TRIANGLE` | "TRI" | Triangle wave |
| `SHAPE_RAMP` | "RAMP" | Ramp (sawtooth) |
| `SHAPE_NOISE` | "NOIS" | White noise |
| `SHAPE_DC` | "DC" | DC voltage |
| `SHAPE_USER` | "USER" | User-defined arbitrary |

### Voltage Units
| Constant | Value | Description |
|----------|-------|-------------|
| `UNIT_VPP` | "VPP" | Volts peak-to-peak |
| `UNIT_VRMS` | "VRMS" | Volts RMS |
| `UNIT_DBM` | "DBM" | dBm (50Ω reference) |

### Load Impedance
| Constant | Value | Description |
|----------|-------|-------------|
| `LOAD_50_OHM` | 50 | 50Ω termination |
| `LOAD_HIGH_Z` | "INF" | High impedance |

### Trigger/Sweep Constants
| Constant | Value | Description |
|----------|-------|-------------|
| `TRIGGER_IMMEDIATE` | "IMM" | Continuous output |
| `TRIGGER_EXTERNAL` | "EXT" | External trigger |
| `TRIGGER_BUS` | "BUS" | Software trigger |
| `SLOPE_POSITIVE` | "POS" | Trigger on rising edge |
| `SLOPE_NEGATIVE` | "NEG" | Trigger on falling edge |
| `SWEEP_LINEAR` | "LIN" | Linear frequency sweep |
| `SWEEP_LOGARITHMIC` | "LOG" | Logarithmic frequency sweep |

### Modulation Sources
| Constant | Value | Description |
|----------|-------|-------------|
| `AM_SOURCE_BOTH` | "BOTH" | AM internal + external |
| `AM_SOURCE_EXTERNAL` | "EXT" | AM external only |
| `SOURCE_INTERNAL` | "INT" | Internal source (burst/FSK) |
| `SOURCE_EXTERNAL` | "EXT" | External source (burst/FSK) |

---

## Standard Waveforms (APPLy Methods)

The APPLy methods are the simplest way to configure standard waveforms.

### apply_sine / apply_square / apply_triangle / apply_ramp

```python
awg.apply_sine(freq, amplitude=None, offset=None)
awg.apply_square(freq, amplitude=None, offset=None)
awg.apply_triangle(freq, amplitude=None, offset=None)
awg.apply_ramp(freq, amplitude=None, offset=None)
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `freq` | float | Output frequency in Hz (required) |
| `amplitude` | float | Peak-to-peak voltage (optional) |
| `offset` | float | DC offset voltage (optional, requires amplitude) |

### apply_noise

```python
awg.apply_noise(amplitude=None, offset=None)
```

Output white noise. Frequency parameter is not applicable.

### apply_dc

```python
awg.apply_dc(offset)
```

Output a DC voltage at the specified offset.

### apply_user

```python
awg.apply_user(freq, amplitude=None, offset=None)
```

Output the currently selected user-defined arbitrary waveform.

### get_apply_config

```python
config = awg.get_apply_config()  # Returns: '"SIN 1000,2.0,0.0"'
```

---

## Output Parameters

### Frequency

```python
awg.set_frequency(hz)
freq = awg.get_frequency()  # Returns float
```

### Amplitude

```python
awg.set_amplitude(vpp)
amp = awg.get_amplitude()  # Returns float
```

### Offset

```python
awg.set_offset(volts)
offset = awg.get_offset()  # Returns float
```

### Function Shape

```python
awg.set_function_shape(HP33120A.SHAPE_SINE)
shape = awg.get_function_shape()  # Returns "SIN"
```

### Load Impedance

```python
awg.set_load_impedance(50)           # 50Ω
awg.set_load_impedance(HP33120A.LOAD_HIGH_Z)  # High-Z
load = awg.get_load_impedance()      # Returns "50" or "INF"
```

### Voltage Unit

```python
awg.set_voltage_unit(HP33120A.UNIT_VRMS)
unit = awg.get_voltage_unit()  # Returns "VPP", "VRMS", or "DBM"
```

### Duty Cycle (Square Wave Only)

```python
awg.set_duty_cycle(45)  # 20-80%, frequency dependent
duty = awg.get_duty_cycle()  # Returns float
```

### Sync Output

```python
awg.set_sync_output(True)   # Enable SYNC terminal
awg.set_sync_output(False)  # Disable
sync = awg.get_sync_output()  # Returns bool
```

---

## Arbitrary Waveforms

### upload_waveform_dac

```python
awg.upload_waveform_dac(data, name=None)
```

Upload waveform using signed DAC integer values.

| Parameter | Type | Description |
|-----------|------|-------------|
| `data` | array-like | Values from -2047 to +2047 (8-16000 points) |
| `name` | str | If provided, copy to non-volatile memory |

**Example:**
```python
import numpy as np

# Create a signed triangle wave
triangle = np.array([-2047, -1024, 0, 1024, 2047, 1024, 0, -1024], dtype=np.int16)
awg.upload_waveform_dac(triangle, name="MYTRI")
```

### upload_waveform_float

```python
awg.upload_waveform_float(data, name=None)
```

Upload waveform using normalized float values (-1.0 to +1.0).

**Example:**
```python
wave = np.sin(np.linspace(0, 2*np.pi, 100))  # Already in -1 to +1 range
awg.upload_waveform_float(wave, name="MYSINE")
```

### select_user_waveform

```python
awg.select_user_waveform("MYWAVE")
```

Select a waveform from memory for USER output.

### list_waveforms / list_user_waveforms

```python
all_waves = awg.list_waveforms()      # Built-in + user
user_waves = awg.list_user_waveforms()  # User only
```

### get_waveform_points / get_free_memory

```python
points = awg.get_waveform_points()        # Volatile memory
points = awg.get_waveform_points("NAME")  # Named waveform
free = awg.get_free_memory()  # Returns bytes available
```

### delete_waveform / delete_all_waveforms

```python
awg.delete_waveform("MYWAVE")
awg.delete_all_waveforms()  # Deletes all user waveforms
```

---

## Modulation

### Amplitude Modulation (AM)

```python
awg.set_am_depth(50)  # 0-120%
awg.set_am_source(HP33120A.AM_SOURCE_BOTH)  # BOTH or EXT
awg.set_am_internal_function(HP33120A.SHAPE_SINE)
awg.set_am_internal_frequency(100)  # Hz
awg.set_am_state(True)  # Enable AM

# Getters
depth = awg.get_am_depth()
source = awg.get_am_source()
func = awg.get_am_internal_function()
freq = awg.get_am_internal_frequency()
enabled = awg.get_am_state()
```

### Frequency Modulation (FM)

```python
awg.set_fm_deviation(1000)  # Peak deviation in Hz
awg.set_fm_internal_function(HP33120A.SHAPE_TRIANGLE)
awg.set_fm_internal_frequency(10)  # Hz
awg.set_fm_state(True)  # Enable FM

# Getters
dev = awg.get_fm_deviation()
func = awg.get_fm_internal_function()
freq = awg.get_fm_internal_frequency()
enabled = awg.get_fm_state()
```

### Burst Modulation

```python
awg.set_burst_cycles(5)    # Integer or "INF"
awg.set_burst_phase(90)    # Starting phase in degrees
awg.set_burst_internal_rate(100)  # Hz
awg.set_burst_source(HP33120A.SOURCE_INTERNAL)  # INT or EXT
awg.set_burst_state(True)  # Enable burst

# Getters
cycles = awg.get_burst_cycles()  # Returns string
phase = awg.get_burst_phase()
rate = awg.get_burst_internal_rate()
source = awg.get_burst_source()
enabled = awg.get_burst_state()
```

---

## FSK (Frequency-Shift Keying)

```python
awg.set_fsk_frequency(2000)  # Hop frequency in Hz
awg.set_fsk_internal_rate(10)  # Shift rate in Hz
awg.set_fsk_source(HP33120A.SOURCE_INTERNAL)  # INT or EXT
awg.set_fsk_state(True)  # Enable FSK

# Getters
hop = awg.get_fsk_frequency()
rate = awg.get_fsk_internal_rate()
source = awg.get_fsk_source()
enabled = awg.get_fsk_state()
```

---

## Frequency Sweep

```python
awg.set_sweep_start_frequency(100)  # Hz
awg.set_sweep_stop_frequency(10000)  # Hz
awg.set_sweep_spacing(HP33120A.SWEEP_LOGARITHMIC)  # LIN or LOG
awg.set_sweep_time(5.0)  # Seconds
awg.set_sweep_state(True)  # Enable sweep

# Getters
start = awg.get_sweep_start_frequency()
stop = awg.get_sweep_stop_frequency()
spacing = awg.get_sweep_spacing()
time = awg.get_sweep_time()
enabled = awg.get_sweep_state()
```

---

## Triggering

Used with burst modulation and frequency sweep.

```python
awg.set_trigger_source(HP33120A.TRIGGER_BUS)  # IMM, EXT, or BUS
awg.set_trigger_slope(HP33120A.SLOPE_POSITIVE)  # POS or NEG
awg.trigger()  # Send software trigger (when source is BUS)

# Getters
source = awg.get_trigger_source()
slope = awg.get_trigger_slope()
```

---

## Display

```python
awg.set_display(True)   # Enable front panel display
awg.set_display(False)  # Disable (faster operation)
enabled = awg.get_display()

awg.set_display_text("TESTING")  # Show custom text (max 12 chars)
text = awg.get_display_text()
awg.clear_display_text()  # Return to normal display
```

---

## System Methods

### Identification

```python
idn = awg.get_identification()  # Returns: "HEWLETT-PACKARD,33120A,..."
version = awg.get_version()  # SCPI version
```

### Reset and Self-Test

```python
awg.reset()  # Reset to defaults
result = awg.self_test()  # Returns 0 if pass
```

### State Save/Recall

```python
awg.save_state(1)    # Save to location 0-3 (0 is overwritten at power-down)
awg.recall_state(1)  # Recall from location
awg.delete_state(1)  # Delete stored state
```

### Beep and Errors

```python
awg.beep()  # Sound the front panel beeper
error = awg.check_errors()  # Returns error string
```

---

## Complete Example

```python
import numpy as np
from gtape_prologix_drivers import PrologixAdapter, HP33120A

# Connect
adapter = PrologixAdapter(port="COM4", gpib_address=10)
awg = HP33120A(adapter)

# Reset and configure
awg.reset()
awg.set_load_impedance(HP33120A.LOAD_HIGH_Z)

# Output a 1kHz sine wave at 2Vpp
awg.apply_sine(1000, amplitude=2.0)

# Create and upload custom waveform (signed -2047 to +2047)
t = np.linspace(0, 2*np.pi, 500)
wave = np.sin(t) + 0.3*np.sin(3*t)
wave_dac = (wave / np.max(np.abs(wave)) * 2047).astype(np.int16)
awg.upload_waveform_dac(wave_dac, name="HARMONIC")

# Select and output the custom waveform
awg.select_user_waveform("HARMONIC")
awg.apply_user(5000, amplitude=1.5, offset=0.5)

# Configure burst mode
awg.set_burst_cycles(10)
awg.set_burst_phase(0)
awg.set_trigger_source(HP33120A.TRIGGER_BUS)
awg.set_burst_state(True)

# Trigger a burst
awg.trigger()

# Clean up
awg.delete_waveform("HARMONIC")
adapter.close()
```

## Waveform Tips

1. **Signed DAC values**: -2047 = negative peak, 0 = zero, +2047 = positive peak
2. **Float format**: -1.0 to +1.0 is easier for math, DAC format is faster to upload
3. **Point count**: More points = better resolution but slower maximum frequency
4. **Non-volatile storage**: Use the `name` parameter to persist waveforms across power cycles
5. **Built-in waveforms**: SINC, RAMP, NEG_RAMP, EXP_RISE, EXP_FALL are pre-loaded
