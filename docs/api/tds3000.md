# TDS3000 Series

Digital Phosphor Oscilloscopes - TDS3054 (4-channel, 500MHz, 5GS/s) and TDS3012B (2-channel, 100MHz, 1.25GS/s).

## Import

```python
from gtape_prologix_drivers import TDS3054, TDS3012B
from gtape_prologix_drivers.instruments.tds3000 import WaveformData
```

## Constructor

```python
TDS3054(adapter)   # 4-channel model
TDS3012B(adapter)  # 2-channel model
```

| Parameter | Type | Description |
|-----------|------|-------------|
| `adapter` | PrologixAdapter | Connected adapter instance |

## Class Constants

| Constant | TDS3054 | TDS3012B | Description |
|----------|---------|----------|-------------|
| `NUM_CHANNELS` | 4 | 2 | Number of input channels |
| `QUERY_DELAY` | 0.1 | 0.1 | Delay between write/read (seconds) |

---

## Identification

### get_id

```python
scope.get_id() -> str
```

Query instrument identification.

**Returns:** IDN string (e.g., "TEKTRONIX,TDS 3012B,0,CF:91.1CT...")

---

### reset

```python
scope.reset() -> None
```

Reset oscilloscope to default settings. Waits 2 seconds for completion.

---

## Channel Control

### get_active_channels

```python
scope.get_active_channels() -> list[str]
```

Detect which channels are currently displayed.

**Returns:** List of channel names (e.g., `["CH1", "CH2"]`)

---

### set_channel_display

```python
scope.set_channel_display(channel: str, on: bool) -> None
```

Turn channel display on or off.

| Parameter | Type | Description |
|-----------|------|-------------|
| `channel` | str | Channel name ("CH1", "CH2", etc.) |
| `on` | bool | True to display, False to hide |

---

### set_channel_scale

```python
scope.set_channel_scale(channel: str, volts_per_div: float) -> None
```

Set vertical scale for a channel.

| Parameter | Type | Description |
|-----------|------|-------------|
| `channel` | str | Channel name |
| `volts_per_div` | float | Volts per division |

---

### set_channel_position

```python
scope.set_channel_position(channel: str, divisions: float) -> None
```

Set vertical position for a channel.

| Parameter | Type | Description |
|-----------|------|-------------|
| `channel` | str | Channel name |
| `divisions` | float | Divisions from center (positive = up) |

---

### set_channel_coupling

```python
scope.set_channel_coupling(channel: str, coupling: str) -> None
```

Set channel input coupling.

| Parameter | Type | Description |
|-----------|------|-------------|
| `channel` | str | Channel name |
| `coupling` | str | "DC", "AC", or "GND" |

---

## Horizontal Control

### set_timebase

```python
scope.set_timebase(seconds_per_div: float) -> None
```

Set horizontal timebase.

| Parameter | Type | Description |
|-----------|------|-------------|
| `seconds_per_div` | float | Seconds per division |

**Example:**
```python
scope.set_timebase(1e-3)   # 1 ms/div
scope.set_timebase(100e-6) # 100 Âµs/div
```

---

### set_record_length

```python
scope.set_record_length(length: int) -> int
```

Set horizontal record length.

| Parameter | Type | Description |
|-----------|------|-------------|
| `length` | int | Number of points (500, 10000, etc.) |

**Returns:** Actual length set by scope (may differ from requested)

---

### get_sample_rate

```python
scope.get_sample_rate() -> float
```

Query current sample rate.

**Returns:** Sample rate in samples per second

> **Note:** This command may not be supported on all firmware versions.

---

## Trigger Control

### set_trigger_source

```python
scope.set_trigger_source(source: str) -> None
```

Set edge trigger source.

| Parameter | Type | Description |
|-----------|------|-------------|
| `source` | str | "CH1", "CH2", "CH3", "CH4", "EXT", "LINE" |

---

### set_trigger_level

```python
scope.set_trigger_level(volts: float) -> None
```

Set trigger level.

| Parameter | Type | Description |
|-----------|------|-------------|
| `volts` | float | Trigger threshold in volts |

---

### set_trigger_slope

```python
scope.set_trigger_slope(slope: str) -> None
```

Set trigger slope.

| Parameter | Type | Description |
|-----------|------|-------------|
| `slope` | str | "RISe" or "FALL" |

---

### set_trigger_mode

```python
scope.set_trigger_mode(mode: str) -> None
```

Set trigger mode.

| Parameter | Type | Description |
|-----------|------|-------------|
| `mode` | str | "AUTO", "NORMal", or "SINGle" |

---

### force_trigger

```python
scope.force_trigger() -> None
```

Force a trigger event immediately.

---

## Acquisition Control

### run

```python
scope.run() -> None
```

Start acquisition.

---

### stop

```python
scope.stop() -> None
```

Stop acquisition.

---

### single

```python
scope.single() -> None
```

Acquire single sequence then stop.

---

### set_acquire_mode

```python
scope.set_acquire_mode(mode: str) -> None
```

Set acquisition mode.

| Parameter | Type | Description |
|-----------|------|-------------|
| `mode` | str | "SAMple", "PEAKdetect", "HIRes", "AVErage", "ENVelope" |

---

### set_average_count

```python
scope.set_average_count(count: int) -> None
```

Set number of waveforms to average.

| Parameter | Type | Description |
|-----------|------|-------------|
| `count` | int | Number of averages (2-512) |

---

## Waveform Capture

### read_waveform

```python
scope.read_waveform(channel: str) -> WaveformData
```

Read waveform from channel.

| Parameter | Type | Description |
|-----------|------|-------------|
| `channel` | str | Channel name ("CH1", "CH2", etc.) |

**Returns:** `WaveformData` object

#### WaveformData

```python
@dataclass
class WaveformData:
    channel: str        # Channel name
    time: np.ndarray    # Time values in seconds
    voltage: np.ndarray # Voltage values in volts
    preamble: dict      # Metadata from scope
```

**Preamble fields:**
| Field | Type | Description |
|-------|------|-------------|
| `byt_nr` | int | Bytes per point (1 or 2) |
| `bit_nr` | int | Bits per point |
| `nr_pt` | int | Number of points |
| `xincr` | float | Time per point (seconds) |
| `xzero` | float | Time of first point |
| `ymult` | float | Voltage multiplier |
| `yoff` | float | Voltage offset (raw units) |
| `yzero` | float | Voltage zero offset |

**Example:**
```python
waveform = scope.read_waveform("CH1")

# Access data
print(f"Points: {len(waveform.voltage)}")
print(f"Sample rate: {1/waveform.preamble['xincr']:.2e} Sa/s")

# Plot with matplotlib
import matplotlib.pyplot as plt
plt.plot(waveform.time, waveform.voltage)
plt.xlabel("Time (s)")
plt.ylabel("Voltage (V)")
plt.show()
```

---

## Measurements

### measure

```python
scope.measure(measurement_type: str, channel: str) -> float
```

Take an immediate measurement on a channel.

| Parameter | Type | Description |
|-----------|------|-------------|
| `measurement_type` | str | Measurement type (see below) |
| `channel` | str | Source channel |

**Returns:** Measurement value as float

**Measurement types:**
| Type | Description |
|------|-------------|
| `FREQuency` | Signal frequency |
| `PERIod` | Signal period |
| `MEAN` | Mean voltage |
| `PK2pk` | Peak-to-peak voltage |
| `CRMS` | Cycle RMS |
| `MIN` | Minimum voltage |
| `MAX` | Maximum voltage |
| `RISEtime` | Rise time |
| `FALLtime` | Fall time |
| `PWIdth` | Positive pulse width |

**Example:**
```python
freq = scope.measure("FREQuency", "CH1")
pk2pk = scope.measure("PK2pk", "CH1")
mean = scope.measure("MEAN", "CH1")

print(f"Frequency: {freq:.2f} Hz")
print(f"Pk-Pk: {pk2pk:.3f} V")
print(f"Mean: {mean:.3f} V")
```

---

## Error Handling

### check_errors

```python
scope.check_errors() -> str
```

Query scope for errors using standard event status register.

**Returns:** "0" if no errors, otherwise error description

---

## Complete Example

```python
from gtape_prologix_drivers import PrologixAdapter
from gtape_prologix_drivers.instruments.tds3000 import TDS3012B

# Connect
adapter = PrologixAdapter(port="COM4", gpib_address=21)
scope = TDS3012B(adapter)

# Identify
print(scope.get_id())

# Configure
scope.set_channel_scale("CH1", 1.0)     # 1 V/div
scope.set_timebase(1e-3)                 # 1 ms/div
scope.set_trigger_source("CH1")
scope.set_trigger_level(0.5)
scope.set_trigger_mode("AUTO")
scope.set_record_length(10000)

# Capture
scope.run()
waveform = scope.read_waveform("CH1")

# Measure
freq = scope.measure("FREQuency", "CH1")
pk2pk = scope.measure("PK2pk", "CH1")

print(f"Captured {len(waveform.voltage)} points")
print(f"Frequency: {freq:.2f} Hz, Pk-Pk: {pk2pk:.3f} V")

# Cleanup
adapter.close()
```
